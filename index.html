<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Obliczenia otworów w kantówce</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 0 15px; }
  label { display: block; margin-top: 15px; }
  input[type=number] { width: 100%; padding: 8px; font-size: 16px; }
  button { margin-top: 10px; padding: 8px 15px; font-size: 16px; cursor: pointer; }
  .results { margin-top: 30px; }
  canvas { margin-top: 20px; border: 1px solid #ccc; width: 100%; max-width: 580px; height: 80px; }
  .inline-controls { display: flex; gap: 10px; margin-top: 5px; }
</style>
</head>
<body>

<h1>Obliczenia otworów w kantówce</h1>

<label for="kantowkaLength">Długość kantówki (mm):</label>
<input type="number" id="kantowkaLength" min="1" step="1" placeholder="np. 2000" />

<label for="otworWidth">Szerokość otworu (mm):</label>
<input type="number" id="otworWidth" min="1" step="1" placeholder="np. 50" />

<label for="maxDistance">Maksymalny odstęp między otworami (mm):</label>
<input type="number" id="maxDistance" min="1" step="1" placeholder="np. 400" value="400" />

<label>Liczba otworów:</label>
<div class="inline-controls">
  <button id="decreaseHoles">-</button>
  <input type="number" id="holesCount" min="2" step="1" value="2" style="width:60px; text-align:center;" />
  <button id="increaseHoles">+</button>
</div>

<button id="calculateBtn">Oblicz</button>

<div class="results" id="results"></div>

<canvas id="schemat"></canvas>

<script>
  function calculatePositions(kantowkaLength, otworWidth, holesCount) {
    if (kantowkaLength <= 0 || otworWidth <= 0 || holesCount < 2) return null;
    if (otworWidth * holesCount > kantowkaLength) return null;

    // Odstępy między otworami liczone od krawędzi do krawędzi (równe)
    const totalGap = kantowkaLength - otworWidth * holesCount;
    const gap = totalGap / (holesCount -1);

    // Pozycje krawędzi otworów od początku kantówki
    let positions = [];
    for(let i=0; i<holesCount; i++) {
      positions.push(i * (otworWidth + gap));
    }

    return { holesCount, gap, positions };
  }

  function drawScheme(kantowkaLength, otworWidth, positions) {
    const canvas = document.getElementById('schemat');
    const ctx = canvas.getContext('2d');

    canvas.width = canvas.clientWidth * window.devicePixelRatio;
    canvas.height = 80 * window.devicePixelRatio;
    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

    const scale = 580 / kantowkaLength;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Rysuj kantówkę
    ctx.fillStyle = '#eee';
    ctx.fillRect(0, 20, kantowkaLength * scale, 40);

    // Rysuj otwory
    ctx.fillStyle = '#007ACC';
    positions.forEach(pos => {
      ctx.fillRect(pos * scale, 20, otworWidth * scale, 40);
    });

    // Podpisy pozycji (krawędź otworu)
    ctx.fillStyle = '#000';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    positions.forEach(pos => {
      ctx.fillText(Math.round(pos) + ' mm', (pos + otworWidth/2) * scale, 15);
    });
  }

  function updateHolesCount(newCount) {
    const kantowkaLength = parseFloat(document.getElementById('kantowkaLength').value);
    const otworWidth = parseFloat(document.getElementById('otworWidth').value);
    const maxDistance = parseFloat(document.getElementById('maxDistance').value);

    if (isNaN(kantowkaLength) || isNaN(otworWidth) || isNaN(maxDistance)) return;

    // Sprawdź czy da się ustawić taką liczbę otworów
    if (newCount < 2) newCount = 2;
    if (otworWidth * newCount > kantowkaLength) {
      alert('Zbyt wiele otworów na taką długość kantówki.');
      return;
    }

    // Oblicz odstępy przy nowej liczbie otworów
    const totalGap = kantowkaLength - otworWidth * newCount;
    const gap = totalGap / (newCount - 1);

    if (gap > maxDistance) {
      alert(`Przekroczono maksymalny odstęp między otworami (${maxDistance} mm).`);
      return;
    }

    document.getElementById('holesCount').value = newCount;
    calculateAndDisplay();
  }

  function calculateAndDisplay() {
    const kantowkaLength = parseFloat(document.getElementById('kantowkaLength').value);
    const otworWidth = parseFloat(document.getElementById('otworWidth').value);
    const maxDistance = parseFloat(document.getElementById('maxDistance').value);
    let holesCount = parseInt(document.getElementById('holesCount').value);

    if (isNaN(kantowkaLength) || kantowkaLength <= 0) {
      alert('Podaj poprawną długość kantówki.');
      return;
    }
    if (isNaN(otworWidth) || otworWidth <= 0 || otworWidth > kantowkaLength) {
      alert('Podaj poprawną szerokość otworu (mniejszą niż długość kantówki).');
      return;
    }
    if (isNaN(maxDistance) || maxDistance <= 0) {
      alert('Podaj poprawny maksymalny odstęp między otworami.');
      return;
    }
    if (holesCount < 2) holesCount = 2;

    // Sprawdź, czy można spełnić maxDistance
    const totalGap = kantowkaLength - otworWidth * holesCount;
    if (totalGap < 0) {
      alert('Zbyt wiele otworów na taką długość kantówki.');
      return;
    }
    const gap = totalGap / (holesCount - 1);
    if (gap > maxDistance) {
      alert(`Przekroczono maksymalny odstęp między otworami (${maxDistance} mm). Spróbuj zwiększyć liczbę otworów.`);
      return;
    }

    const result = calculatePositions(kantowkaLength, otworWidth, holesCount);
    if (!result) {
      alert('Błąd obliczeń.');
      return;
    }

    let html = `<p><strong>Liczba otworów:</strong> ${result.holesCount}</p>`;
    html += `<p><strong>Odstęp między otworami (krawędź do krawędzi):</strong> ${result.gap.toFixed(1)} mm</p>`;
    html += '<p><strong>Pozycje otworów (od krawędzi początku kantówki):</strong></p><ul>';
    result.positions.forEach((pos, i) => {
      html += `<li>Otwór ${i + 1}: ${pos.toFixed(1)} mm</li>`;
    });
    html += '</ul>';

    document.getElementById('results').innerHTML = html;
    drawScheme(kantowkaLength, otworWidth, result.positions);
  }

  document.getElementById('calculateBtn').addEventListener('click', calculateAndDisplay);

  document.getElementById('increaseHoles').addEventListener('click', () => {
    let holesCount = parseInt(document.getElementById('holesCount').value) || 2;
    holesCount++;
    updateHolesCount(holesCount);
  });

  document.getElementById('decreaseHoles').addEventListener('click', () => {
    let holesCount = parseInt(document.getElementById('holesCount').value) || 2;
    holesCount--;
    if (holesCount < 2) holesCount = 2;
    updateHolesCount(holesCount);
  });

</script>

</body>
</html>
